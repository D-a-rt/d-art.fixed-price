# Exhibition contract

The contract is in the directory ligo/there.exhibition and the corresponding test in ligo/test/there.exhibition

The purpose of the exhibition contract is to enable curators to create a time based exhibition by inviting creators to collaborate with one or more of there artworks.

The different features are:

For Admin:

- Sending artwork based invitation to creators
- Remove artwork based invitation to creators
- Setting a start date and an end date
- Setting a commission (splitted)
- Setting a grace period
- List synthetic assets for sales (before the grace period)
- Edit listing

- Start grace period
- Reset exhibition (before the start-date, will send all the tokens back to the creators in order to restart the process entirely - preventing curators from holding power over creators by locking the assets)

For Creators:

- Accept artwork based invitation
- Accept Listings
- Claim artwork (if not sold or if in grace period)

## Storage definition

This section is responsible to list and explain the storage of the exhibition contract.

```ocaml

type fa2_base =
[@layout:comb]
{
  id : nat;
  address : address;
}

type storage =
[@layout:comb]
{
    admin: admin_storage;
    exhibition: (fa2_base * minter, nat) big_map;
    next_nat_id: nat;
    metadata : (string, bytes) big_map;
}
```

## admin

The first field is `admin` and has it's own definition:

```ocaml
type storage =
[@layout:comb]
{
    admin: admin_storage;
    ...
}

type split =
[@layout:comb]
{
    address: address;
    pct: nat;
}

type admin_storage = {
    start_date: timestamp;
    end_date: timestamp;
    grace_period: nat; (* In seconds *)
    grace_started: timestamp option;
    commission: nat;
    commission_splits: split list;
    pending_invites: (fa2_base * minter, unit) big_map;
}
```

- `start_date`: The start date of the exhibition
- `end_date`: The end date of the exhibition
- `grace_period`: The period during which the exhibition is pre-locked and creators can pull-out artworks from it, after this period the exhibition will be locked until the end-date unless the curator unlock-it before the start date
- `grace_started`: The moment at wich the grace period has been started.
- `commission`: The percentage of the sale that will be commissioned to the curator 155 -> 15.5%
- `commission_split`: list of commission split
- `split`: address and correcponding percentage, the total number of pct should be = 1000
- `pending_invites`: Pending artworks invitations.

## exhibition

The second field is exhibition and it is a big map. The key of the map is a tuple of (fa2_base \* minter) and the value is a nat.

```ocaml
type storage =
[@layout:comb]
{
    ...
    exhibition: (fa2_base * minter, nat) big_map;
    ...
}
```

- `fa2_base`: The address of the token contract used in the exhibition
- `minter`: The address of the minter contract used in the exhibition
- `nat`: The id of the synthetic assets associated to the (fa2_base, minter) pair.

This big map make the connection between the synthetic assets generated by the contract and the actual FA2 tokens.

## next_nat_id

The third field is `next_nat_id` and it is a nat. This is an auto-incrementing counter that is used to generate unique IDs for synthetic assets.

```ocaml
type storage =
[@layout:comb]
{
    ...
    next_nat_id: nat;
    ...
}
```

The `next_nat_id` counter is incremented every time a new synthetic asset is created. Synthetic assets are identified by a unique nat ID that is generated by this counter. They will be the ones used in the sales contracts instead of the real tokens in order to extend the metadata of the previous tokens to incorporate the commissions for the curators.

## metadata

The fourth field is metadata and it is a big map. The key of the map is a string and the value is a bytes.

```ocaml
type storage =
[@layout:comb]
{
    ...
    metadata : (string, bytes) big_map;
}
```

This field is used to store metadata associated with the smart contract itself. The metadata can be used to provide additional information about the contract, such as the name of the curator, the name of the exhibition, or any other relevant information. The metadata is stored as a big map, where the key is a string that identifies the metadata, and the value is a byte array that contains the actual data or is a link to a the metadata on IPFS.
