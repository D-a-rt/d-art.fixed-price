# Exhibition contract

The contract is in the directory ligo/there.exhibition and the corresponding test in ligo/test/there.exhibition

The purpose of the exhibition contract is to enable curators to create a time based exhibition by inviting creators to collaborate with one or more of there artworks.

The different features are:

### For Admin:

- Sending artwork-based invitation to creators
- Remove artwork-based invitation to creators
- Setting a start date and an end date
- Setting a commission (splitted)
- Setting a grace period
- List synthetic assets for sales (before the grace period)
- Edit listing

- Start grace period
- Reset exhibition (before the start-date, will send all the tokens back to the creators in order to restart the process entirely - preventing curators from holding power over creators by locking the assets)

### For Creators:

- Accept artwork based invitation
- Accept Listings
- Claim artwork (if not sold or if in grace period)

### Complementary informations regarding synthetic assets in the context of this contract:

Synthetic assets in the context of this exhibition contract are essentially placeholders that represent real FA2 tokens, which are the actual assets being sold. The purpose of the synthetic assets is to extend the metadata of the previous tokens to incorporate the commissions for the curators.

When a curator invites a creator to collaborate with their artwork, a synthetic asset is generated for that collaboration. This synthetic asset is given a unique ID that is generated by the next_nat_id counter in the contract's storage. The synthetic asset is associated with a real FA2 token and a minter contract that will mint new tokens for the exhibition.

Before the exhibition period starts, the synthetic assets will be listed. If a synthetic asset is sold, the FA2 token associated with that asset will be transferred to the buyer, the creator will receive payment + royalties and the curator will be credited with a commission for the sale. The commission is split according to the percentages specified in the commission_splits field of the admin_storage.

## Storage definition

This section is responsible to list and explain the storage of the exhibition contract.

```ocaml

type synthetic_id = nat

type fa2_base =
[@layout:comb]
{
  id : nat;
  address : address;
}

type fa2_token =
[@layout:comb]
{
  id : nat;
  address : address;
  amount: nat;
}

type commodity =
  | Tez of tez
  | Fa2 of fa2_token

type sale_info =
[@layout:comb]
{
  buyer : address option;
  commodity: commodity;
}

type storage =
[@layout:comb]
{
    admin: admin_storage;
    exhibition: (fa2_base * minter, synthetic_id) big_map;
    next_synthetic_id: nat;
    metadata : (string, bytes) big_map;
}
```

## admin

The first field is `admin` and has it's own definition:

```ocaml
type storage =
[@layout:comb]
{
    admin: admin_storage;
    ...
}

type split =
[@layout:comb]
{
    address: address;
    pct: nat;
}

type admin_storage = {
    admin: address;
    start_date: timestamp;
    end_date: timestamp;
    grace_period: nat; (* In seconds *)
    grace_started: timestamp option;
    commission: nat;
    commission_splits: split list;
    pending_invites: (fa2_base * minter, unit) big_map;
    pending_listings: (synthetic_id, sale_info) big_map;
}
```

- `start_date`: The start date of the exhibition
- `end_date`: The end date of the exhibition
- `grace_period`: The period during which the exhibition is pre-locked and creators can pull-out artworks from it, after this period the exhibition will be locked until the end-date unless the curator unlock-it before the start date
- `grace_started`: The moment at wich the grace period has been started.
- `commission`: The percentage of the sale that will be commissioned to the curator 155 -> 15.5%
- `commission_split`: list of commission split
- `split`: address and correcponding percentage, the total number of pct should be = 1000
- `pending_invites`: Pending artworks invitations.

## exhibition

The second field is exhibition and it is a big map. The key of the map is a tuple of (fa2_base \* minter) and the value is a nat.

```ocaml
type storage =
[@layout:comb]
{
    ...
    exhibition: (fa2_base * minter, nat) big_map;
    ...
}
```

- `fa2_base`: The address of the token contract used in the exhibition
- `minter`: The address of the minter contract used in the exhibition
- `nat`: The id of the synthetic assets associated to the (fa2_base, minter) pair.

This big map make the connection between the synthetic assets generated by the contract and the actual FA2 tokens.

## next_synthetic_id

The third field is `next_synthetic_id` and it is a nat. This is an auto-incrementing counter that is used to generate unique IDs for synthetic assets.

```ocaml
type storage =
[@layout:comb]
{
    ...
    next_synthetic_id: nat;
    ...
}
```

The `next_synthetic_id` counter is incremented every time a new synthetic asset is created. Synthetic assets are identified by a unique nat ID that is generated by this counter. They will be the ones used in the sales contracts instead of the real tokens in order to extend the metadata of the previous tokens to incorporate the commissions for the curators.

## metadata

The fourth field is metadata and it is a big map. The key of the map is a string and the value is a bytes.

```ocaml
type storage =
[@layout:comb]
{
    ...
    metadata : (string, bytes) big_map;
}
```

This field is used to store metadata associated with the smart contract itself. The metadata can be used to provide additional information about the contract, such as the name of the curator, the name of the exhibition, or any other relevant information. The metadata is stored as a big map, where the key is a string that identifies the metadata, and the value is a byte array that contains the actual data or is a link to the metadata on IPFS.

# Entrypoints

The different entrypoints of the contract are defined by:

```ocaml

type exhibition_params =
    | Admin of admin_entrypoints
    | Creator of creator_entrypoints
```

## Admin

```ocaml

type sale_configuration =
[@layout:comb]
{
    sale_infos : (synthetic_id * sale_info)  list;
}

type admin_entrypoints =
    | Send_invitations of (fa2_base * minter) list
    | Remove_invitations of (fa2_base * minter) list
    | Set_start_date of timestamp
    | Set_end_date of timestamp
    | Set_commission of nat
    | Set_commission_split of split list
    | Set_grace_period of nat
    | List_synthetic_assets of sale_configuration
    | Edit_listings of sale_configuration
    | Start_grace_period
    | Reset_exhibition

```

### Send_invitations

The `Send_invitation` entrypoint is responsible to send (an) invitation(s) to the specified minter for the fa2_base specified.


### Remove_invitations

The `Remove_invitation` entrypoints is reponsible to remove the invitation of a specific token and minter


### Set_start_date

The `Set_start_date` entrypoints is reponsible to set the start date of the exhibition


### Set_end_date

The `Set_end_date` entrypoints is responsible to set the end date of the exhibition


### Set_commission

The `Set_commission` entrypoints is reponsible to set the commission that the curator will perceive if a sale happen during the exhibition.


### Set_commission_split

The `Set_commission_split` entrypoints is responsible to set the commission split that the curators want to add for this specific exhibition


### Set_grace_period

The `Set_grace_period` entrypoints is responsible to set the duration of the grace period.

### List_synthetic_assets

After the invitations being accepted the curator of the contract can pre-set listing for the artworks curated, once accepted by the creator they will then be listed.

`List_synthetic_assets` is responsible to submit the listing from the curator to the creator.

### Edit_listings

The `Edit_listing` entrypoint is responsible to edit the listing of the listed token in case the creator did not accept the listing.

### Start_grace_period

The `Start_grace_period` start the grace period during wich the creator can pull-out from the exhibition one last time and nothing can be added to the contract.

### Reset_exhibition

The `Reset_exhibition` is the entrypoint to reset the contract, can only be done before the start_date of the exhibition.


## Creator

```ocaml

type accept = bool

type creator_entrypoints =
    | Accept_invitations of (fa2_base * accept) list
    | Accept_listings of (nat * accept) list
    | Claim_artworks of nat list

```

### Accept_invitations

The `Accept_invitations` entrypoint is responsible to accept or refuse artwork-based invitations.

### Accept_listings

The `Accept_listings` entrypoint is responsible to accept the listings proposed by the curator to the creators, note that this is in the phase two.

### Claim_artworks

The `Claim_artworks` entypoint will be accessible by any creator until the end of the grace_period or after the end_date of the exhibition if the artworks are not sold.